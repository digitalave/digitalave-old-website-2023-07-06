I"Èi<h1 id="install--configure-elk-stack-68-on-centos7">INSTALL &amp; CONFIGURE ELK STACK 6.8 ON CENTOS7</h1>
<p><img src="/images/pages/elk-stack/ELK.png" width="100%" /></p>

<h2 id="introduction">INTRODUCTION</h2>

<p>‚ÄúELK‚Äù is the acronym for the three open source projects call Elasticsearch, Logstash and Kibana. ELK stack made easier to analyze logs to system administrators. ELK stack collect logs from clients using Beats protocol</p>

<h2 id="elk-stack-main-components">ELK STACK MAIN COMPONENTS</h2>

<p><strong>Elasticsearch</strong> is an open source, distributed, RESTful, JSON based search and analytic engine. Easy to use and flexible. Elasticsearch is the heart of ELK stack. Elasticsearch is a No-SQL database.</p>

<p><strong>Logstash</strong> is a open source, server-side data processing pipeline that pull events data from multitude of sources simultaneously, transform it, and then sends it to Elasticsearch. Easily pull data from logs, metrics, web applications, data sources and various AWS services. Logstash dynamically transforms and prepares data regardless of format or complexity. Derive structure from unstructured data with grock.</p>

<p><strong>Kibana</strong> provides GUI for users visualize data with charts and graphs real-time. It is a window into the Elastic Stack. Provides data exploration, visualization and dashboarding.</p>

<p><strong>Beats</strong> is the platform for single-purpose data shippers. They install as lightweight agents and send data from numerous machines to Logstash of</p>

<p><img src="/images/pages/elk-stack/image002.png" width="100%" /></p>

<p><img src="/images/pages/elk-stack/image003.png" width="100%" /></p>

<p>Software Versions I have used in this tutorial.</p>

<p>ELK Stack Server 192.168.10.10 (CentOS7)
Beat Client 192.168.0.49 (CentOS7)
Elasticsearch Version: 6.8 
Logstash Version 6.8 
Kibana Version 6.8</p>

<h2 id="step-1-complete-prerequsites">STEP 1: COMPLETE PREREQUSITES</h2>

<h4 id="set-hostname">SET HOSTNAME</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/hostname
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/hosts
</code></pre></div></div>

<h4 id="clear-and-remove-yum-cache">CLEAR AND REMOVE YUM CACHE</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> /etc/yum.repos.d/<span class="nv">$REPONAME</span>.repo
yum clean all
</code></pre></div></div>

<p>Delete the yum cache for the repo</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> <span class="nt">-rf</span> /var/cache/yum/x86_64/6/<span class="nv">$REPONAME</span>
</code></pre></div></div>

<p>Clearing the yum Caches</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su <span class="nt">-c</span> <span class="s1">'yum clean headers'</span>
su <span class="nt">-c</span> <span class="s1">'yum clean packages'</span>
su <span class="nt">-c</span> <span class="s1">'yum clean metadata'</span>
</code></pre></div></div>

<h3 id="install-and-update-latest-rpm-repositories">Install and Update Latest RPM Repositories</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">-ivh</span> https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm

rpm <span class="nt">-ivh</span> https://mirror.webtatic.com/yum/el7/webtatic-release.rpm

rpm <span class="nt">-ivh</span> http://rpms.famillecollet.com/enterprise/remi-release-7.rpm

rpm <span class="nt">-ivh</span> https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm

rpm <span class="nt">-ivh</span> http://repository.it4i.cz/mirrors/repoforge/redhat/el7/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el7.rf.x86_64.rpm
</code></pre></div></div>

<h2 id="step-2-install-java-jdk">STEP 2: INSTALL JAVA JDK</h2>

<p>Java is required for the Elastic stack deployment. Elasticsearch requires Java 8, it is recommended to use the Oracle JDK 1.8. I will install Java 8 from the official Oracle rpm package. ELK requires the Oracle Java JDK package has to be installed. The same JVM version should be installed on all Elasticsearch nodes and clients.</p>

<h3 id="install-jdk-rpm">INSTALL JDK RPM</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">-Uvh</span> jdk-8u211-linux-x64.rpm
</code></pre></div></div>

<h3 id="set-default-java-version">SET DEFAULT JAVA VERSION</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alternatives <span class="nt">--config</span> java

alternatives <span class="nt">--set</span> jar /usr/java/jdk1.8.0_211-amd64/bin/jar

alternatives <span class="nt">--set</span> javac /usr/java/jdk1.8.0_211-amd64/bin/javac
</code></pre></div></div>

<h3 id="set-java-environment-variables">SET JAVA ENVIRONMENT VARIABLES</h3>
<p>SET JAVAC AND JAR PATHS</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk1.8.0_211-amd64/
<span class="nb">export </span><span class="nv">JRE_HOME</span><span class="o">=</span>/usr/java/jdk1.8.0_211-amd64/jre/
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/java/jdk1.8.0_211-amd64/bin/:/usr/java/jdk1.8.0_211-amd64/jre/bin/
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">vim ~/.bashrc</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk1.8.0_211-amd64/
<span class="nb">export </span><span class="nv">JRE_HOME</span><span class="o">=</span>/usr/java/jdk1.8.0_211-amd64/jre/
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/java/jdk1.8.0_211-amd64/bin/:/usr/java/jdk1.8.0_211-amd64/jre/bin/
</code></pre></div></div>

<h3 id="check-java-version">CHECK JAVA VERSION</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-version</span>
</code></pre></div></div>

<h2 id="step-3-install-and-configure-elasticsearch">STEP 3: INSTALL AND CONFIGURE ELASTICSEARCH</h2>

<p>In this step, I will install and configure Elasticsearch version 6.8</p>

<h4 id="import-public-gpg-key-to-the-elk-stack-server">IMPORT PUBLIC GPG KEY TO THE ELK-STACK SERVER</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">--import</span> https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre></div></div>

<h4 id="create-yum-repo-file-for-elasticsearch">CREATE YUM REPO FILE FOR ELASTICSEARCH</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/yum.repos.d/elasticsearch.repo</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>logstash-6.x]
<span class="nv">name</span><span class="o">=</span>Elastic repository <span class="k">for </span>6.x packages
<span class="nv">baseurl</span><span class="o">=</span>https://artifacts.elastic.co/packages/6.x/yum
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
<span class="nv">enabled</span><span class="o">=</span>1
<span class="nv">autorefresh</span><span class="o">=</span>1
<span class="nb">type</span><span class="o">=</span>rpm-md
</code></pre></div></div>

<h4 id="install-elasticsearch-yum-packages">INSTALL ELASTICSEARCH YUM PACKAGES</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>elasticsearch
</code></pre></div></div>

<h4 id="configure-elasticsearch">CONFIGURE ELASTICSEARCH</h4>

<p>Do the following changes</p>

<p><code class="language-plaintext highlighter-rouge">vim /etc/elasticsearch/elasticsearch.yml</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cluster.name: elk
node.name: node-1
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: 192.168.10.10
http.port: 9200
</code></pre></div></div>

<p><img src="\images\elk-stack68\elastic1.PNG" width="100%" /></p>

<p><code class="language-plaintext highlighter-rouge">vim /etc/elasticsearch/jvm.options</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-Xms4g</span>
<span class="nt">-Xmx4g</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">FIREWALL CONFIGURATION</code></p>

<p>Allow traffic through the TCP port 9200 in the firewall.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>9200/tcp
firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>9300/tcp
firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h4 id="start--enable-elasticsearch-at-system-boot">START &amp; ENABLE ELASTICSEARCH AT SYSTEM BOOT</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl <span class="nb">enable </span>elasticsearch.service
systemctl restart elasticsearch.service
systemctl status <span class="nt">-l</span> elasticsearch.service
</code></pre></div></div>

<h4 id="test-elasticsearch">TEST ELASTICSEARCH</h4>

<p>Check Elasticsearch port ‚Äú9200‚Äù state as ‚ÄúLISTEN‚Äù</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat <span class="nt">-plntu</span>
</code></pre></div></div>

<h4 id="open-in-browser">OPEN IN BROWSER</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.10.10:9200/?pretty
</code></pre></div></div>

<h4 id="open-in-terminal">OPEN IN TERMINAL</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XGET</span> <span class="s1">'192.168.10.10:9200/?pretty'</span>
</code></pre></div></div>

<h2 id="step-4-install-and-configure-logstash">STEP 4: INSTALL AND CONFIGURE LOGSTASH</h2>

<p>In this step I will install Logstash version 6.8 and configure it as a central log server, receives logs from clients with Filebeat, then filter and transform the syslog data and move it into the stash (Elasticsearch)</p>

<h4 id="import-public-gpg-key-to-the-elk-stack-server-1">IMPORT PUBLIC GPG KEY TO THE ELK-STACK SERVER</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">--import</span> https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre></div></div>

<h4 id="create-yum-repo-file-for-elasticsearch-1">CREATE YUM REPO FILE FOR ELASTICSEARCH</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/yum.repos.d/logstash.repo</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>logstash-6.x]
<span class="nv">name</span><span class="o">=</span>Elastic repository <span class="k">for </span>6.x packages
<span class="nv">baseurl</span><span class="o">=</span>https://artifacts.elastic.co/packages/6.x/yum
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
<span class="nv">enabled</span><span class="o">=</span>1
<span class="nv">autorefresh</span><span class="o">=</span>1
<span class="nb">type</span><span class="o">=</span>rpm-md
</code></pre></div></div>

<h4 id="install-logstash-yum-packages">INSTALL LOGSTASH YUM PACKAGES</h4>

<p>sudo yum -y install logstash</p>

<p>NOTE: Need to genarate SSL Certificate if you using SSL.</p>

<p>GENERATE A NEW SSL CERTIFICATE
Create new ssl certificate for securing communication between Logstash &amp; Filebeat (clients). SSL Certificate file use clients to identify the elastic server.</p>

<p>Do the following changes under the ‚Äú[ V3_ca ]‚Äù section for the server identification.</p>

<p><code class="language-plaintext highlighter-rouge">vim /etc/pki/tls/openssl.cnf</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span> v3_ca <span class="o">]</span>
<span class="c">#Server IP Address</span>
subjectAltName <span class="o">=</span> IP: 192.168.10.10
</code></pre></div></div>

<p>Generate the certificate file with the openssl command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-config</span> /etc/pki/tls/openssl.cnf <span class="nt">-x509</span> <span class="nt">-days</span> 3650 <span class="nt">-batch</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> /etc/pki/tls/private/logstash-forwarder.key <span class="nt">-out</span> /etc/pki/tls/certs/logstash-forwarder.crt
</code></pre></div></div>

<p>Once ssl certificate is ready, this certificate should be copied to all the clients using scp command.</p>

<h3 id="configure-logstash">CONFIGURE LOGSTASH</h3>

<p><code class="language-plaintext highlighter-rouge">vim /etc/logstash/logstash.yml</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.data: /var/lib/logstash
http.host: <span class="s2">"192.168.10.10"</span>
path.logs: /var/log/logstash
</code></pre></div></div>

<p><img src="\images\elk-stack68\logstash1.PNG" width="100%" /></p>

<h4 id="jvm-configuration">JVM configuration</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/logstash/jvm.options</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-Xms2g</span>
<span class="nt">-Xmx2g</span>
</code></pre></div></div>

<h4 id="create-following-files-under-etclogstashconfd-directory">Create Following Files Under /etc/logstash/conf.d/ Directory.</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/logstash/conf.d/auditbeat.conf</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### INPUT SECTION ###</span>
<span class="c">### This section make Logstash to listen on port 5044 for incoming logs &amp; provides SSL certificate for secure connection.</span>
input <span class="o">{</span>
  beats <span class="o">{</span>
    port <span class="o">=&gt;</span> 5044
<span class="c">#   ssl =&gt; true</span>
<span class="c">#   ssl_certificate =&gt; "/etc/pki/tls/certs/logstash-forwarder.crt"</span>
<span class="c">#   ssl_key =&gt; "/etc/pki/tls/private/logstash-forwarder.key"</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c">### FILTER SECTION ###</span>
<span class="c">### This section parse the logs before sending them to Elasticsearch.</span>
filter <span class="o">{</span>
<span class="k">if</span> <span class="o">[</span><span class="nb">type</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"syslog"</span> <span class="o">{</span>
    grok <span class="o">{</span>
      match <span class="o">=&gt;</span> <span class="o">{</span> <span class="s2">"message"</span> <span class="o">=&gt;</span> <span class="s2">"%{SYSLOGLINE}"</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="nb">date</span> <span class="o">{</span>
match <span class="o">=&gt;</span> <span class="o">[</span> <span class="s2">"timestamp"</span>, <span class="s2">"MMM  d HH:mm:ss"</span>, <span class="s2">"MMM dd HH:mm:ss"</span> <span class="o">]</span>
<span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span>

<span class="c">### OUTPUT SECTION ###</span>
<span class="c">### This section defines the storage for the logs to be stored.</span>
output <span class="o">{</span>
  elasticsearch <span class="o">{</span>
    hosts <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"http://192.168.10.10:9200"</span><span class="o">]</span>
    manage_template <span class="o">=&gt;</span> <span class="nb">false
    </span>index <span class="o">=&gt;</span> <span class="s2">"%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.DD}"</span>
    document_type <span class="o">=&gt;</span> <span class="s2">"%{[@metadata][type]}"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="firewall-configuration">FIREWALL CONFIGURATION</h4>
<p>Allow traffic through the TCP port 5044 in the firewall.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>5044/tcp
firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h4 id="enable--start-logstash-service">ENABLE &amp; START LOGSTASH SERVICE</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>logstash.service 
systemctl restart logstash.service 
systemctl status <span class="nt">-l</span> logstash.service
</code></pre></div></div>

<h2 id="step-5-install-and-configure-kibana">STEP 5: INSTALL AND CONFIGURE KIBANA</h2>

<h4 id="import-public-gpg-key-to-the-elk-stack-server-2">IMPORT PUBLIC GPG KEY TO THE ELK-STACK SERVER</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">--import</span> https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre></div></div>

<h4 id="create-yum-repo-file-for-kibana">CREATE YUM REPO FILE FOR KIBANA</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/yum.repos.d/kibana.repo</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>kibana-6.x]
<span class="nv">name</span><span class="o">=</span>Kibana repository <span class="k">for </span>6.x packages
<span class="nv">baseurl</span><span class="o">=</span>https://artifacts.elastic.co/packages/6.x/yum
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
<span class="nv">enabled</span><span class="o">=</span>1
<span class="nv">autorefresh</span><span class="o">=</span>1
<span class="nb">type</span><span class="o">=</span>rpm-md
</code></pre></div></div>

<h4 id="install-kibana-yum-packages">INSTALL KIBANA YUM PACKAGES</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install </span>kibana
</code></pre></div></div>

<h4 id="configure-kibana">CONFIGURE KIBANA</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/kibana/kibana.yml</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server.port: 5601
server.host: <span class="s2">"0.0.0.0"</span>
server.name: <span class="s2">"elk"</span>
elasticsearch.hosts: <span class="o">[</span><span class="s2">"http://192.168.10.10:9200"</span><span class="o">]</span>
</code></pre></div></div>

<p><img src="\images\elk-stack68\kibana1.PNG" width="100%" /></p>

<h4 id="firewall-configuration-1">FIREWALL CONFIGURATION</h4>
<p>Allow traffic through the TCP port 5044 in the firewall.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>5601/tcp
firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h4 id="enable--start-logstash-service-1">ENABLE &amp; START LOGSTASH SERVICE</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload 
systemctl <span class="nb">enable </span>kibana.service
systemctl restart kibana.service
</code></pre></div></div>

<h2 id="step-6-install-and-configure-nginx">STEP 6: INSTALL AND CONFIGURE NGINX</h2>

<h4 id="insatll-epel-repository">INSATLL EPEL REPOSITORY</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install </span>epel-release
</code></pre></div></div>

<h4 id="install-nginx--httpd-tools">INSTALL NGINX &amp; HTTPD-TOOLS</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install </span>nginx httpd-tools
</code></pre></div></div>

<p>CREATE USERNAME ‚ÄúADMIN‚Äù AND PASSWORD ‚Äú123456‚Äù FOR KIBANA WEB INTERFACE</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>htpasswd <span class="nt">-c</span> /etc/nginx/htpasswd.kibana admin
</code></pre></div></div>

<h4 id="configure-nginx">CONFIGURE NGINX</h4>
<p>Edit the Nginx configuration file and remove the ‚Äòserver { }‚Äô block, so we can add a new virtual host configuration.</p>

<p><code class="language-plaintext highlighter-rouge">vim /etc/nginx/nginx.conf</code></p>

<p>COMMENT {Server} Block:</p>

<p>Create new virtual host configuration file named ‚Äúkibana.conf‚Äù under the conf.d directory.</p>

<h4 id="create-vhost-for-kibana">Create VHOST FOr KIBANA:</h4>

<p><code class="language-plaintext highlighter-rouge">vim /etc/nginx/conf.d/kibana.conf</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 80<span class="p">;</span>

    server_name elk-stack.co<span class="p">;</span>

    auth_basic <span class="s2">"Restricted Access"</span><span class="p">;</span>
    auth_basic_user_file /etc/nginx/htpasswd.kibana<span class="p">;</span>

    location / <span class="o">{</span>
        proxy_pass http://localhost:5601<span class="p">;</span>
        proxy_http_version 1.1<span class="p">;</span>
        proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
        proxy_set_header Connection <span class="s1">'upgrade'</span><span class="p">;</span>
        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
        proxy_cache_bypass <span class="nv">$http_upgrade</span><span class="p">;</span>
    <span class="o">}</span>
   <span class="o">}</span>
</code></pre></div></div>

<p><img src="\images\elk-stack68\nginx_kibana.PNG" width="100%" /></p>

<h4 id="check-nginx-configuration">Check Nginx Configuration</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx <span class="nt">-t</span>
</code></pre></div></div>

<h4 id="firewall-configuration-2">FIREWALL CONFIGURATION</h4>
<p>Allow traffic through the TCP port 80 in the firewall.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>80/tcp
firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-service</span><span class="o">=</span>http
firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h4 id="enable--start-nginx-service">ENABLE &amp; START NGINX SERVICE</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>nginx.service 
systemctl restart nginx.service
</code></pre></div></div>

<h4 id="selinux-confguration">SELINUX CONFGURATION</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setsebool <span class="nt">-P</span> httpd_can_network_connect 1
</code></pre></div></div>

<h2 id="step-07-connect-kibana-frontend-with-elasticsearch">STEP 07: Connect Kibana Frontend With Elasticsearch</h2>

<h5 id="you-need-assign-kibana-to-which-elasticsearch-indeces-you-want-yo-explore">You need assign Kibana to which Elasticsearch indeces you want yo explore.</h5>

<p>Configure the Elasticsearch Indices what you want to access with Kibana.</p>

<p>Open Web Browser and Point To‚Ä¶
(Only via Kibana)
<code class="language-plaintext highlighter-rouge">http://YOURIP.com:5601</code></p>

<p>OR</p>

<p>(If nginx/apache proxy redirect with VHOST)
<code class="language-plaintext highlighter-rouge">http://YOURIP.com:80</code></p>

<p><img src="\images\elk-stack68\1_N.jpg" width="100%" /></p>

<p>Navigate To</p>

<p><code class="language-plaintext highlighter-rouge">Managemnt &gt;&gt; Kibana &gt;&gt; Create Index Pattern</code></p>

<p><img src="\images\elk-stack68\6_N.jpg" width="100%" />
Now Navigate To</p>

<p><code class="language-plaintext highlighter-rouge">Discover &gt;&gt; (Now You Search For Logs By Available Fields)</code></p>

<p><img src="\images\elk-stack68\3_N.jpg" width="100%" /></p>

<h3 id="bottom-line">Bottom Line:</h3>

<h5 id="hope-you-guys-get-some-idea-about-how-to-install-elk-stack-on-centos7-step-by-step-and-monitor-system-logs-in-a-effective-manner">Hope you guys get some idea about how to install ELK Stack on CentOS7 step by step. And monitor system logs in a effective manner.</h5>

<h2 id="in-the-next-lesson-i-will-teach-you-following-points">In the next lesson I will teach you following points.</h2>
<ol>
  <li>How to Install Beat Log Collectors on Client Systems.</li>
  <li>How to Search Log Data and Narrow down them into your Requirement</li>
  <li>How To Save Search Data</li>
  <li>How To Visualize Data</li>
  <li>How To Create Dashboards</li>
  <li>How To Use Dev Tools</li>
  <li>Log Rotate Effectively</li>
  <li>Optimize Logstash (Increase Index Search Performance &amp; Lower Hardware Requirements)</li>
</ol>

<p><strong>Video Tutorial on YouTube Will Be Available Soon.</strong></p>

<p><img src="\images\elk-stack68\5_N.jpg" width="100%" /></p>

<p><a href="https://www.youtube.com/channel/UCovlVsoRVItner26ZJPBjmQ?sub_confirmation=1"><img src="Docker-Installation/sub.gif" /></a></p>

<p><a href="https://www.youtube.com/channel/UCovlVsoRVItner26ZJPBjmQ?sub_confirmation=1"><img src="Docker-Installation/sub.gif" alt="Foo" /></a></p>
:ET