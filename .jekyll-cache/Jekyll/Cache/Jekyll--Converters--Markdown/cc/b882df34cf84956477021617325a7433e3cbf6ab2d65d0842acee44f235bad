I"’«<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
<div class="embed-container"><iframe src="https://www.youtube.com/embed/TfyCYt6S5XQ?&amp;autoplay=1" frameborder="0" allowfullscreen=""></iframe></div>

<p><strong>In this tutorial I‚Äôll going to demonstrate how to setup Wazuh.</strong></p>

<h3 id="what-is-wazuh">What is Wazuh?</h3>

<p>Wazuh is a free, open source and enterprise-ready security detection and monitoring solution.</p>

<p>Wazuh is born as a fork of OSSEC (HIDS) host based intrusion detection system. Later is was integrated with Elastic stack and OpenSCAP.</p>

<p>Which can perform threat detection, integrity monitoring, incident response and compliance.</p>

<p><strong>Wazuh System consist with several components:</strong></p>

<ul>
  <li>
    <p>OSSEC HIDS - Host Based Intrusion Detection System</p>
  </li>
  <li>
    <p>OpenSCAP - Open Vulnerability Assessment Language</p>
  </li>
  <li>
    <p>Elastic Stack - Filebeat, Elasticsearch, Kibana</p>
  </li>
  <li>
    <p>Wazuh is loaded with number of valued capabilities.</p>
  </li>
</ul>

<h3 id="main-features">Main Features:</h3>

<h4 id="1-security-analytics">1. Security Analytics:</h4>

<p>Wazuh is used to collect, aggregate, index and analyze security data which helping to detect intrusions,  threats and anomalies.</p>

<p>Endpoint Detection and Response (EDR)</p>

<p>Wazuh Agent actively perform security analysts discover, investigate and perform block a network attack, stop a malicious process or quarantine a malware infected file.</p>

<h4 id="2-intrusion-detection">2. Intrusion Detection</h4>

<p>Wazuh-Agent scan the monitored system looking for malware, rootkits and suspicious anomalies. Also It can detect hidden files, clocked processes or  unregistered network listeners.</p>

<h4 id="3-log-data-analysis">3. Log Data Analysis</h4>

<p>Wazuh-Agent read operating system and application logs, and forward them to a central Wazuh-Manager for rule-based analysis.</p>

<p>Which helps you to  aware of application or system errors,miss-configuration, attempted successful malicious activities, policy violations and many more.</p>

<h4 id="4-file-integrity-monitoring">4. File Integrity Monitoring</h4>

<p>Wazuh monitors the file system, identifying changes in content, permissions, ownership and attributes of files that you need to keep an eye on.</p>

<p>Also It can identify users and applications used to create or modify files.</p>

<h4 id="5-vulnerability-detection">5. Vulnerability Detection</h4>

<p>Wazuh agent pull software inventory data and send them to the Wazuh Manager server. Then, they matches with CVE (Common Vulnerabilities and Exposure) databases, in order to identify well-know vulnerable software.</p>

<p>Automated vulnerability assessment helps you find the weak spots in your critical assets and take corrective action before attackers exploit them to sabotage your business or steal confidential data.</p>

<h4 id="6-configuration-assessment">6. Configuration Assessment</h4>

<p>Wazuh monitors system and application configuration settings to  ensure they are compliant with you security policies and standards.</p>

<p>Agent automatically performs periodic scan to detect applications that are know to be vulnerable, unpatched, or insecurely configured.</p>

<p>And also It alerts recommendations for  better configuration and security hardening.</p>

<h4 id="7-incident-response">7. Incident Response</h4>

<p>Wazuh take action against active threats such  as blocking access from the threat source when certain criteria are met.</p>

<h4 id="8-regulatory-compliance">8. Regulatory Compliance</h4>

<p>Wazuh provides some of necessary security  controls to become complaint with industry standards and regulations.</p>

<h4 id="9-cloud-security">9. Cloud Security</h4>

<p>Wazuh helps monitoring cloud infrastructure as an API level.
It can pull security data from instances on well known cloud providers such as AWS, Azure, Google Cloud Platform.</p>

<h4 id="10-containers-security">10. Containers Security</h4>

<p>Wazhuh provides security  visibility  into your docker hosts and containers.</p>

<h3 id="step-01-perform-prerequisites">STEP 01: Perform Prerequisites</h3>

<h5 id="a-install-latest-yum-repositories">A. Install latest yum repositories</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install </span>https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-12.noarch.rpm

yum <span class="nb">install </span>http://rpms.remirepo.net/enterprise/remi-release-7.rpm

yum <span class="nb">install </span>https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm

yum <span class="nb">install </span>http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm

yum <span class="nb">install </span>https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm

yum <span class="nb">install </span>http://mirror.ghettoforge.org/distributions/gf/el/7/gf/x86_64/gf-release-7-10.gf.el7.noarch.rpm
</code></pre></div></div>

<h5 id="b-set-hostname-with-fully-qualified-domain-name-fqdn">B. Set Hostname with Fully Qualified Domain Name (FQDN)</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# vim /etc/hostname 

wazuh-elk
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# vim /etc/hosts

172.25.10.50    wazuh-elk.da.com        wazuh-elk
</code></pre></div></div>

<h5 id="c-selinux-configuration">C. SELinux Configuration</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# vim /etc/selinux/config

<span class="nv">SELINUX</span><span class="o">=</span>permissive
</code></pre></div></div>

<h5 id="d-install-python3">D. Install Python3</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server1 ~]# yum <span class="nb">install </span>python3
</code></pre></div></div>

<h3 id="setp-02-install-wazuh-manager">SETP 02: Install Wazuh Manager</h3>

<h5 id="a-install-development-tools-compilers-and-other-required-packages">A. Install Development Tools, Compilers, and Other Required Packages.</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# yum <span class="nb">install </span>make gcc policycoreutils-python automake autoconf libtool
</code></pre></div></div>

<p>OpenSSL will be required to create a system certificate while authentication with Wazuh Agents.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# yum <span class="nb">install </span>openssl
</code></pre></div></div>

<p>Install Latest EPEL-Release</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# yum <span class="nb">install </span>epel-release yum-utils <span class="nt">-y</span>
</code></pre></div></div>

<p>Install Budild Dependencies of CPython</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# yum-builddep python34 <span class="nt">-y</span>
</code></pre></div></div>

<h5 id="b-download-and-extract-wazuh-installation-files">B. Download and Extract Wazuh Installation Files</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# curl <span class="nt">-Ls</span> https://github.com/wazuh/wazuh/archive/v3.11.1.tar.gz | <span class="nb">tar </span>zx

<span class="o">[</span>root@server1 ~]# <span class="nb">cd </span>wazuh-3.11.1/
</code></pre></div></div>

<h5 id="c-run-the-installsh-script">C. Run the ‚ÄúInstall.sh‚Äù Script</h5>

<p>This will guide you through the installation process.
When Script ask for what kind of installation need to perform, type ‚Äúmanager‚Äù to install the Wazuh Manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 wazuh-3.11.1]# ./install.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">**</span> Para instala√ß√£o em portugu√™s, escolha <span class="o">[</span>br].
 <span class="o">(</span>en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr<span class="o">)</span> <span class="o">[</span>en]: en

Wazuh v3.11.1 <span class="o">(</span>Rev. 31116<span class="o">)</span> Installation Script - http://www.wazuh.com

You are about to start the installation process of Wazuh.
You must have a C compiler pre-installed <span class="k">in </span>your system.

 - System: Linux server1 3.10.0-862.el7.x86_64 <span class="o">(</span>centos 7.5<span class="o">)</span>
 - User: root
 - Host: server1
</code></pre></div></div>

<p>‚Äì Press ENTER to continue or Ctrl-C to abort. ‚Äì</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1- What kind of installation <span class="k">do </span>you want <span class="o">(</span>manager, agent, <span class="nb">local</span>, hybrid or <span class="nb">help</span><span class="o">)</span>? manager

2- Setting up the installation environment.

 - Choose where to <span class="nb">install </span>Wazuh <span class="o">[</span>/var/ossec]: 

3- Configuring Wazuh.

  3.1- Do you want e-mail notification? <span class="o">(</span>y/n<span class="o">)</span> <span class="o">[</span>n]: y 
   - What<span class="s1">'s your e-mail address? user@gmail.com

   - We found your SMTP server as: alt1.gmail-smtp-in.l.google.com.
   - Do you want to use it? (y/n) [y]: y

   --- Using SMTP server:  alt1.gmail-smtp-in.l.google.com.

  3.2- Do you want to run the integrity check daemon? (y/n) [y]: y

   - Running syscheck (integrity check daemon).

  3.3- Do you want to run the rootkit detection engine? (y/n) [y]: y

   - Running rootcheck (rootkit detection).

  3.4- Do you want to run policy monitoring checks? (OpenSCAP) (y/n) [y]: y

   - Running OpenSCAP (policy monitoring checks).

  3.5- Active response allows you to execute a specific
       command based on the events received.
       By default, no active responses are defined.

   - Default white list for the active response:
      - 172.25.10.1
      - 8.8.8.8
      
   - Do you want to add more IPs to the white list? (y/n)? [n]: n

  3.6- Do you want to enable remote syslog (port 514 udp)? (y/n) [y]: y

   - Remote syslog enabled.

  3.7 - Do you want to run the Auth daemon? (y/n) [y]: y

   - Running Auth daemon.

  3.8- Do you want to start Wazuh after the installation? (y/n) [y]: y

   - Wazuh will start at the end of installation.

  3.9- Setting the configuration to analyze the following logs:

    -- /var/log/audit/audit.log
    -- /var/ossec/logs/active-responses.log
    -- /var/log/messages
    -- /var/log/secure
    -- /var/log/maillog

 - If you want to monitor any other file, just change
   the ossec.conf and add a new localfile entry.
   Any questions about the configuration can be answered
   by visiting us online at https://documentation.wazuh.com/.


   --- Press ENTER to continue ---

4- Installing the system

 - Running the Makefile

Finished processing dependencies for wazuh==3.11.1
Installing SCAP security policies...
Generating self-signed certificate for ossec-authd...
Building CDB lists...


Created symlink from /etc/systemd/system/multi-user.target.wants/wazuh-manager.service to /etc/systemd/system/wazuh-manager.service.
Starting Wazuh...

 - Configuration finished properly.

 - To start Wazuh:
      /var/ossec/bin/ossec-control start

 - To stop Wazuh:
      /var/ossec/bin/ossec-control stop

 - The configuration can be viewed or modified at /var/ossec/etc/ossec.conf


---------------------------------
[root@server1 wazuh-3.11.1]# /var/ossec/bin/ossec-control start
Starting Wazuh v3.11.1...
Started ossec-csyslogd...
Started ossec-dbd...
2020/01/13 05:13:08 ossec-integratord: INFO: Remote integrations not configured. Clean exit.
Started ossec-integratord...
Started ossec-agentlessd...
ossec-authd already running...
wazuh-db already running...
ossec-execd already running...
ossec-maild already running...
ossec-analysisd already running...
ossec-syscheckd already running...
ossec-remoted already running...
ossec-logcollector already running...
ossec-monitord already running...
wazuh-modulesd already running...
Completed.
----------------------------------
</span></code></pre></div></div>
<h5 id="d-allow-wazuh-manager-service-ports-through-the-firewall">D. Allow Wazuh Manager Service Ports Through The Firewall</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">={</span>514,1514,1515,1516<span class="o">}</span>/tcp
<span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">={</span>514,1514<span class="o">}</span>/udp
<span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<p>514 - send collected events from syslogs</p>

<p>1514 - Send collected event from agents</p>

<p>1515 - Agents registration service</p>

<p>1516 - Wazuh  cluster communications</p>

<h5 id="e-enable-service--restart">E. Enable Service &amp; Restart</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 wazuh-3.11.1]# systemctl daemon-reload
<span class="o">[</span>root@server1 wazuh-3.11.1]# systemctl <span class="nb">enable </span>wazuh-manager.service
<span class="o">[</span>root@server1 wazuh-3.11.1]# systemctl restart wazuh-manager.service
<span class="o">[</span>root@server1 wazuh-3.11.1]# systemctl status <span class="nt">-l</span>  wazuh-manager.service
</code></pre></div></div>

<h3 id="step-03-install-wazuh-api">STEP 03: Install Wazuh API</h3>

<h5 id="a-install-nodejs">A. Install NodeJS</h5>

<p>NodeJS required in order to  run Wazuh API.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# curl <span class="nt">--silent</span> <span class="nt">--location</span> https://rpm.nodesource.com/setup_8.x | bash -
<span class="o">[</span>root@server1 ~]# <span class="nb">sudo </span>yum <span class="nb">install </span>gcc-c++ make
<span class="o">[</span>root@server1 ~]# <span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> nodejs
</code></pre></div></div>

<h5 id="b-install-yarn">B. Install Yarn</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# curl <span class="nt">-sL</span> https://dl.yarnpkg.com/rpm/yarn.repo | <span class="nb">sudo tee</span> /etc/yum.repos.d/yarn.repo
<span class="o">[</span>root@server1 ~]# <span class="nb">sudo </span>yum <span class="nb">install </span>yarn
</code></pre></div></div>

<h5 id="c-install-wazuh-api">C. Install Wazuh API</h5>

<p>Download &amp; Extract Wazuh API Package</p>

<p>Run this command to download and install the Wazuh API</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server1 ~]# curl <span class="nt">-s</span> <span class="nt">-o</span> install_api.sh https://raw.githubusercontent.com/wazuh/wazuh-api/v3.11.1/install_api.sh <span class="o">&amp;&amp;</span> bash ./install_api.sh download
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">API URL</span><span class="pi">:</span> <span class="s">http://host_ip:55000/</span>
<span class="na">user</span><span class="pi">:</span> <span class="s1">'</span><span class="s">foo'</span>
<span class="na">password</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bar'</span>
<span class="na">Configuration</span><span class="pi">:</span> <span class="s">/var/ossec/api/configuration</span>
<span class="na">Test</span><span class="pi">:</span> <span class="s">curl -u foo:bar -k http://127.0.0.1:55000?pretty</span>
<span class="na">Note</span><span class="pi">:</span> <span class="s">You can configure the API executing /var/ossec/api/scripts/configure_api.sh</span>

<span class="c1">### [API installed successfully] ###</span>
</code></pre></div></div>

<h5 id="d-allow-wazuh-api-service-port-through-the-firewall">D. Allow Wazuh-API Service Port Through the Firewall</h5>

<p>55000/TCP - Incoming HTTP requests</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>55000/tcp
<span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h5 id="e-enable-service--restart-1">E. Enable Service &amp; Restart</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# systemctl <span class="nb">enable </span>wazuh-api.service
<span class="o">[</span>root@wazuh-elk ~]# systemctl restart wazuh-api.service
<span class="o">[</span>root@wazuh-elk ~]# systemctl status <span class="nt">-l</span> wazuh-api.service
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_sources_centos.html#wazuh-server-sources-centos" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_sources_centos.html#wazuh-server-sources-centos</a></p>

<h5 id="step-04-install-filebeat">STEP 04: Install Filebeat</h5>

<p>Filebeat is a fork of the Elastic Stack.
Filebeat use to forward alerts and event to  Elasticsearch.</p>

<h5 id="a-import-public-gpg-key">A. Import Public GPG Key</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# rpm <span class="nt">--import</span> https://packages.elastic.co/GPG-KEY-elasticsearch
</code></pre></div></div>

<h5 id="b-create-yum-repository-file">B. Create YUM Repository File</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# vim /etc/yum.repos.d/elastic.repo
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>elasticsearch-7.x]
<span class="nv">name</span><span class="o">=</span>Elasticsearch repository <span class="k">for </span>7.x packages
<span class="nv">baseurl</span><span class="o">=</span>https://artifacts.elastic.co/packages/7.x/yum
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
<span class="nv">enabled</span><span class="o">=</span>1
<span class="nv">autorefresh</span><span class="o">=</span>1
<span class="nb">type</span><span class="o">=</span>rpm-md
</code></pre></div></div>

<h5 id="c-install-filebeat">C. Install Filebeat</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# yum <span class="nb">install </span>filebeat
</code></pre></div></div>

<h5 id="d-download-pre-configured-configuration-file">D. Download pre-configured Configuration File</h5>

<p>This file pre-configured to forward alerts Elasticsearch.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# curl <span class="nt">-so</span> /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/v3.11.1/extensions/filebeat/7.x/filebeat.yml
</code></pre></div></div>

<p>Provide required permission</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# <span class="nb">chmod </span>go+r /etc/filebeat/filebeat.yml
</code></pre></div></div>

<h5 id="e-download-alerts-template-for-elasticsearch">E. Download alerts template for Elasticsearch</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# curl <span class="nt">-so</span> /etc/filebeat/wazuh-template.json https://raw.githubusercontent.com/wazuh/wazuh/v3.11.1/extensions/elasticsearch/7.x/wazuh-template.json
</code></pre></div></div>

<p>Provide required permission</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# <span class="nb">chmod </span>go+r /etc/filebeat/wazuh-template.json
</code></pre></div></div>

<h5 id="f-download-wazuh-module-for-filebeat">F. Download Wazuh module for Filebeat</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# curl <span class="nt">-s</span> https://packages.wazuh.com/3.x/filebeat/wazuh-filebeat-0.1.tar.gz | <span class="nb">sudo tar</span> <span class="nt">-xvz</span> <span class="nt">-C</span> /usr/share/filebeat/module
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_packages_centos.html#wazuh-server-packages-centos-filebeat" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_packages_centos.html#wazuh-server-packages-centos-filebeat</a></p>

<h3 id="step-05-install-java-jdk">STEP 05: Install JAVA JDK</h3>

<p>Java is required for the Elastic stack deployment. Java is to be installed on Elasticseach node.</p>

<h5 id="a-download--install--jdk-rpm">A. Download &amp; Install  JDK RPM</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# rpm <span class="nt">-ivh</span> jdk-13.0.1_linux-x64_bin.rpm
</code></pre></div></div>

<h5 id="b-set-default-java-version">B. Set Default JAVA Version</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# alternatives <span class="nt">--config</span> java
<span class="o">[</span>root@wazuh-elk /]# alternatives <span class="nt">--set</span> jar /usr/java/jdk-13.0.1/bin/jar
<span class="o">[</span>root@wazuh-elk /]# alternatives <span class="nt">--set</span> javac /usr/java/jdk-13.0.1/bin/javac
</code></pre></div></div>

<h5 id="c-set-java-environment-variables">C. Set JAVA Environment Variables</h5>

<p>Set the JAR and JAVAC paths
Add entries into .bashrc and .bash_profile for the persistence even after the reboot.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# <span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk-13.0.1/
<span class="o">[</span>root@wazuh-elk /]# <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/java/jdk-13.0.1/bin/
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# vim ~/.bashrc
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk-13.0.1/
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/java/jdk-13.0.1/bin/
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# vim ~/.bash_profile
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/jdk-13.0.1/
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/java/jdk-13.0.1/bin/
</code></pre></div></div>

<h3 id="step-06-install-elasticsearch">STEP 06: Install Elasticsearch</h3>

<h5 id="a-install-elasticsearch-from-yum-repositories">A. Install Elasticsearch From YUM Repositories.</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# yum <span class="nb">install </span>elasticsearch
</code></pre></div></div>

<h5 id="b-allow-elasticearch-service-ports-through-the-firewall">B. Allow Elasticearch Service Ports Through The Firewall</h5>

<p>9200/tcp - Elasticearch RESTful API
9300-9400/tcp - Elasticsearch cluster communication</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">={</span>9200,9300<span class="o">}</span>/tcp
<span class="o">[</span>root@wazuh-elk ~]# firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h5 id="c-configure-elasticsearch">C. Configure Elasticsearch</h5>

<p>Make Elasticsearch to be able to listening on non loopback IP address. 
In here you can add current machine IP address.
I‚Äôm not going to  change the loopback IP, because this is the one Elastic node I‚Äôm going to setup. So, It doesn‚Äôt need to talk outside.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# vim /etc/elasticsearch/elasticsearch.yml
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node.name: node-1
network.host: 127.0.0.1
http.port: 9200
cluster.initial_master_nodes: <span class="o">[</span><span class="s2">"node-1""]
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# <span class="nb">cat</span> /etc/elasticsearch/elasticsearch.yml | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"^#"</span>
node.name: node-1
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: 127.0.0.1
http.port: 9200
cluster.initial_master_nodes: <span class="o">[</span><span class="s2">"node-1"</span><span class="o">]</span>
</code></pre></div></div>

<h5 id="d-jvm-option-configuration">D. JVM Option Configuration</h5>

<p>Set initial/maximum size of total heap space. If your system has less memory. You should configure it to use small megabytes of ram.</p>

<p>This amount of assigned memory may be vary to amount of your server‚Äôs total physical memory.</p>

<p>In this case I have 6GiB of total physical memory for  the demonstration purpose.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# vim /etc/elasticsearch/jvm.options
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-Xms2g</span>
<span class="nt">-Xmx2g</span>
</code></pre></div></div>

<h5 id="d-enalbe-service--restart">D. Enalbe Service &amp; Restart</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# <span class="nb">sudo </span>systemctl daemon-reload
<span class="o">[</span>root@wazuh-elk /]# <span class="nb">sudo </span>systemctl <span class="nb">enable </span>elasticsearch.service
<span class="o">[</span>root@wazuh-elk /]# <span class="nb">sudo </span>systemctl start elasticsearch.service
</code></pre></div></div>

<h3 id="step-07-configure-filebeat-output-for-elasticsearch">STEP 07: Configure Filebeat Output For Elasticsearch</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# vim /etc/filebeat/filebeat.yml
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output.elasticsearch.hosts: <span class="o">[</span><span class="s1">'http://127.0.0.1:9200'</span><span class="o">]</span>
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_packages_centos.html#wazuh-server-packages-centos-filebeat" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-manager/linux/centos/wazuh_server_packages_centos.html#wazuh-server-packages-centos-filebeat</a></p>

<h5 id="step-08-load-filebeat-template">STEP 08: Load Filebeat Template</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# filebeat setup <span class="nt">--index-management</span> <span class="nt">-E</span> setup.template.json.enabled<span class="o">=</span><span class="nb">false</span>
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-elastic-stack/elastic_server_rpm.html" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-elastic-stack/elastic_server_rpm.html</a></p>

<h3 id="step-09-install-kibana">STEP 09: Install Kibana</h3>

<p>Kibana is the Web interface for visualizing the events stored in elasticsearch.</p>

<h5 id="a-install-kibana">A. Install Kibana</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# yum <span class="nb">install </span>kibana
</code></pre></div></div>

<h5 id="b-install-wazuh-app-plugin-for-kibana">B. Install Wazuh App plugin For Kibana</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# <span class="nb">sudo</span> <span class="nt">-u</span> kibana /usr/share/kibana/bin/kibana-plugin <span class="nb">install </span>https://packages.wazuh.com/wazuhapp/wazuhapp-3.11.1_7.5.1.zip
</code></pre></div></div>

<h5 id="c-configure-kibana">C. Configure Kibana</h5>

<p>Make Kibana to be able to listening on outside of the network and provide Elasticsearch instance IP address.</p>

<p>In this case I‚Äôm going to keep loopback IP for Elasticsearch, Since I don‚Äôt want to expose outside network.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# vim /etc/kibana/kibana.yml
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server.port: 5601
server.host: <span class="s2">"172.25.10.50"</span>
elasticsearch.hosts: <span class="o">[</span><span class="s2">"http://127.0.0.1:9200"</span><span class="o">]</span>
</code></pre></div></div>

<h5 id="d-allow-kibana-service-port-through-the-firewall">D. Allow Kibana Service Port Through The Firewall</h5>

<p>5601/tcp - Kibana Web Interface</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>5601/tcp
<span class="o">[</span>root@wazuh-elk /]# firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<h5 id="e-enable-service--restart-2">E. Enable Service &amp; Restart</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# systemctl daemon-reload
<span class="o">[</span>root@wazuh-elk /]# systemctl <span class="nb">enable </span>kibana.service
<span class="o">[</span>root@wazuh-elk /]# systemctl start kibana.service
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-elastic-stack/elastic_server_rpm.html" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-elastic-stack/elastic_server_rpm.html</a></p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--------------</span> <span class="nt">TROUBLESHOOTING</span> <span class="nt">TIPS</span> <span class="nt">--------------------</span>
<span class="nt">ERROR</span><span class="o">:</span> <span class="nt">wazuh-elk</span> <span class="nt">kibana</span><span class="o">[</span><span class="err">6972</span><span class="o">]:</span> <span class="nt">Browserslist</span><span class="o">:</span> <span class="nt">caniuse-lite</span> <span class="nt">is</span> <span class="nt">outdated</span><span class="o">.</span> <span class="nt">Please</span> <span class="nt">run</span> <span class="nt">next</span> <span class="nt">command</span> <span class="err">`</span><span class="nt">npm</span> <span class="nt">update</span><span class="err">`</span>

<span class="o">[</span><span class="nt">root</span><span class="k">@wazuh-elk</span> <span class="err">~</span><span class="p">]</span><span class="err">#</span> <span class="n">yarn</span> <span class="n">install</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">wazuh-elk</span> <span class="err">~</span><span class="p">]</span><span class="err">#</span> <span class="n">yarn</span> <span class="n">upgrade</span> <span class="n">caniuse-lite</span> <span class="n">browserlist</span>

<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">wazuh-elk</span> <span class="err">~</span><span class="p">]</span><span class="err">#</span> <span class="n">npm</span> <span class="n">update</span>
</code></pre></div></div>

<h2 id="client-side-configuration---adding--registering-wazuh-agent">CLIENT SIDE CONFIGURATION - Adding &amp; Registering Wazuh Agent</h2>

<h3 id="wazuh-agent">Wazuh Agent:</h3>

<p>Wazuh agent runs on the host that you want to monitor.</p>

<p><strong>Wazuh Agent has following capabilities.</strong></p>

<ul>
  <li>Log &amp; data collection</li>
  <li>File integrity monitoring</li>
  <li>Rootkit and malware detection</li>
  <li>security policy monitoring</li>
  <li>Configuration assessment</li>
  <li>software inventory</li>
</ul>

<p><strong>In this scenario I‚Äôm going to install Wazuh Agent on  CentOS and Ubuntu.</strong></p>

<h3 id="step-01-install-wazuh-agent">STEP 01: Install Wazuh Agent</h3>

<h5 id="a-install-development-tools-and-compilers">A. Install Development Tools and Compilers</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 ~]# yum <span class="nb">install </span>make gcc policycoreutils-python automake autoconf libtool
</code></pre></div></div>

<p>Install ‚Äúopenssl‚Äù in order to support certificate creation while installation.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 ~]# yum <span class="nb">install </span>openssl
</code></pre></div></div>

<h5 id="b-download--extract-latest-wazuh-package">B. Download &amp; Extract Latest Wazuh Package</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 ~]# curl <span class="nt">-Ls</span> https://github.com/wazuh/wazuh/archive/v3.11.1.tar.gz | <span class="nb">tar </span>zx
</code></pre></div></div>

<h5 id="c-install-wazuh-agent">C. Install Wazuh Agent</h5>

<p>Run ‚Äúinstall.sh‚Äù script. This will guide you through out the installation process.</p>

<p>Provide necessary responses while the installation process.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 ~]# <span class="nb">cd </span>wazuh-3.11.1/

<span class="o">[</span>root@cl1 wazuh-3.11.1]# ./install.sh
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@cl1 wazuh-3.11.1]# ./install.sh

  ** Para instala√ß√£o em portugu√™s, escolha [br].
  ** ?????????, ??? [cn].
  ** F√ºr eine deutsche Installation, w√§hlen Sie [de].
  ** G?a e??at?stas? sta ????????, ep????te [el].
  ** For installation in English, choose [en].
  ** Para instalar en espa√±ol, elija [es].
  ** Pour une installation en fran√ßais, choisissez [fr]
  ** A Magyar nyelvu telep√≠t√©shez v√°lassza [hu].
  ** Per l'installazione in Italiano, scegli [it].
  ** ?????????????.???????.[jp].
  ** Voor installatie in het Nederlands, kies [nl].
  ** Aby instalowac w jezyku Polskim, wybierz [pl].
  ** ??? ?????????? ?? ????????? ?? ??????? ,??????? [ru].
  ** Za instalaciju na srpskom, izaberi [sr].
  ** T√ºrk√ße kurulum i√ßin se√ßin [tr].
  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: en
 Wazuh v3.11.1 (Rev. 31116) Installation Script - http://www.wazuh.com

 You are about to start the installation process of Wazuh.
 You must have a C compiler pre-installed in your system.

  - System: Linux cl1 3.10.0-862.el7.x86_64 (centos 7.5)
  - User: root
  - Host: cl1


  -- Press ENTER to continue or Ctrl-C to abort. --
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1- What kind of installation do you want (manager, agent, local, hybrid or help)? agent

  - Agent (client) installation chosen.

2- Setting up the installation environment.

 - Choose where to install Wazuh [/var/ossec]: 


    - Installation will be made at  /var/ossec .

3- Configuring Wazuh.

  3.1- What's the IP Address or hostname of the Wazuh server?: 172.25.10.50

   - Adding Server IP 

  3.2- Do you want to run the integrity check daemon? (y/n) [y]: y

   - Running syscheck (integrity check daemon).

  3.3- Do you want to run the rootkit detection engine? (y/n) [y]: y

   - Running rootcheck (rootkit detection).

  3.4- Do you want to run policy monitoring checks? (OpenSCAP) (y/n) [y]: y

   - Running OpenSCAP (policy monitoring checks).

  3.5 - Do you want to enable active response? (y/n) [y]: y

   - Active response enabled.

  3.6- Remote upgrades use packages signed by the system maintainer. The
       corresponding certificate (or root certificate) must be installed
       in the system in order to verify the WPK packages. By default,
       the root certificate by Wazuh is installed.

   - Do you want to add more certificates? (y/n)? [n]: 

  3.7- Setting the configuration to analyze the following logs:

    -- /var/log/audit/audit.log
    -- /var/ossec/logs/active-responses.log
    -- /var/log/messages
    -- /var/log/secure
    -- /var/log/maillog

 - If you want to monitor any other file, just change
   the ossec.conf and add a new localfile entry.
   Any questions about the configuration can be answered
   by visiting us online at https://documentation.wazuh.com/.


   --- Press ENTER to continue ---

4- Installing the system

 - Running the Makefile

 - Configuration finished properly.

 - To start Wazuh:
      /var/ossec/bin/ossec-control start

 - To stop Wazuh:
      /var/ossec/bin/ossec-control stop

 - The configuration can be viewed or modified at /var/ossec/etc/ossec.conf


 - You first need to add this agent to the server so they
   can communicate with each other. When you have done so,
   you can run the 'manage_agents' tool to import the
   authentication key from the server.
   /var/ossec/bin/manage_agents

</code></pre></div></div>

<h5 id="d-allow-wazuh-agent-service-port-through-the-firewall">D. Allow Wazuh-Agent Service Port Through The Firewall</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 ~]# firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">={</span>514,1514<span class="o">}</span>/udp
<span class="o">[</span>root@cl1 ~]# firewall-cmd <span class="nt">--reload</span>
</code></pre></div></div>

<p>Now, Wazuh manger and agent configuration  has been completed. 
Then, We need to add Wazuh-Agents into Wazuh-Manager.</p>

<p>REF: <a href="https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-agent/linux/centos6-or-greater/wazuh_agent_sources_centos6_or_greater.html#wazuh-agent-sources-centos6-or-greater" target="_blank">https://documentation.wazuh.com/3.11/installation-guide/installing-wazuh-agent/linux/centos6-or-greater/wazuh_agent_sources_centos6_or_greater.html#wazuh-agent-sources-centos6-or-greater</a></p>

<h2 id="registering-agents">Registering Agents</h2>

<h3 id="step-01-add-an-agent---add-a-centosredhat-client-agent-to-wazuh-manager">STEP 01: Add an agent - Add a CentOS/Redhat Client Agent To Wazuh-Manager</h3>

<p>Let‚Äôs head over to Wazuh-Manager and perform these configurations.</p>

<p><strong>On the Manager:</strong></p>

<p>Execute this command to add new agent to wazuh-manager.</p>

<blockquote>
  <p>/var/ossec/bin/manage_agents -a <Agent_IP_Adress> -n <Agent_Hostname></Agent_Hostname></Agent_IP_Adress></p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# /var/ossec/bin/manage_agents <span class="nt">-a</span> 172.25.10.100 <span class="nt">-n</span> cl1
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>****************************************
* Wazuh v3.11.1 Agent manager.         *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: 
- Adding a new agent (use '\q' to return to the main menu).
  Please provide the following:
   * A name for the new agent:    * The IP Address of the new agent: Confirm adding it?(y/n): Agent added with ID 001.

manage_agents: Exiting.
</code></pre></div></div>

<h5 id="step-02-list-the-agents">STEP 02: List The Agents</h5>

<p>Execute this command to list the agent to get the ID of the added agent (cl1).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# /var/ossec/bin/manage_agents <span class="nt">-l</span>
</code></pre></div></div>

<p>OR</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# /var/ossec/bin/manage_agents
</code></pre></div></div>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>****************************************
* Wazuh v3.11.1 Agent manager.         *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: L

Available agents: 
   ID: 001, Name: cl1, IP: 172.25.10.100
</code></pre></div></div>

<h5 id="step-03-extract-newly-added-agents-key">STEP 03: Extract Newly Added Agent‚Äôs Key</h5>

<p>Execute this command with the agent ‚ÄúID‚Äù and extract the new agent‚Äôs key.
Cpy this key you will need it for the agent registration.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk /]# /var/ossec/bin/manage_agents <span class="nt">-e</span> 001
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Agent key information <span class="k">for</span> <span class="s1">'001'</span> is: 
<span class="nv">MDAxIGNsMSAxNzIuMjUuMTAuMTAwIDU4N2Y2ZmYyMDA0NmY1NzZmMDc2ODJkOWFlMzM5ZmM1OWY0YzQzYjBhZTk0MjI3NTQyZTkxYTczZmEyZTk4Njk</span><span class="o">=</span>
</code></pre></div></div>

<p>Now, Let‚Äôs head over to agent host.</p>

<p><strong>On the Agent</strong></p>

<h5 id="step-04-import-the-key-to-the-agent-and-connect-agent-to-the-manger">STEP 04: Import the Key To The Agent and Connect Agent To The Manger</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 /]# /var/ossec/bin/manage_agents <span class="nt">-i</span> <span class="nv">MDAxIGNsMSAxNzIuMjUuMTAuMTAwIDU4N2Y2ZmYyMDA0NmY1NzZmMDc2ODJkOWFlMzM5ZmM1OWY0YzQzYjBhZTk0MjI3NTQyZTkxYTczZmEyZTk4Njk</span><span class="o">=</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Agent information:
   ID:001
   Name:cl1
   IP Address:172.25.10.100

Confirm adding it?(y/n): y
Added.
</code></pre></div></div>

<p><strong>OPTIONAL:</strong> Check for Wazuh Manager‚Äôs IP</p>

<p>Edit the Wazuh agent configuration in ‚Äú/var/ossec/etc/ossec.conf‚Äù to add/change the Wazuh Manager Server IP address.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 /]# vim /var/ossec/etc/ossec.conf
</code></pre></div></div>

<h5 id="step-05-restart-wazuh-agent-service">STEP 05: Restart Wazuh Agent Service</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@cl1 /]# systemctl restart wazuh-agent

<span class="o">[</span>root@cl1 /]# systemctl status <span class="nt">-l</span>  wazuh-agent
</code></pre></div></div>

<p>REF: <a href="https://documentation.wazuh.com/3.11/user-manual/registering/cli/using-command-line-linux.html" target="_blank">https://documentation.wazuh.com/3.11/user-manual/registering/cli/using-command-line-linux.html</a></p>

<h2 id="add-a-ubuntu-client-agent-to-wazuh-manager">Add a Ubuntu Client Agent To Wazuh-Manager</h2>

<p><strong>On The Manager:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# /var/ossec/bin/manage_agents <span class="nt">-a</span> 172.25.10.110 <span class="nt">-n</span> DA-PC
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>****************************************
* Wazuh v3.11.1 Agent manager.         *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: 
- Adding a new agent (use '\q' to return to the main menu).
  Please provide the following:
   * A name for the new agent:    
   * * The IP Address of the new agent: 
   * Confirm adding it?(y/n): 
   * Agent added with ID 002.

manage_agents: Exiting.
</code></pre></div></div>

<p>Follow the on screen guide and generate a code.</p>

<h5 id="step-01-adding-an-agent">STEP 01: Adding an agent</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DA-PC:~# curl <span class="nt">-so</span> wazuh-agent.deb https://packages.wazuh.com/3.x/apt/pool/main/w/wazuh-agent/wazuh-agent_3.11.1-1_amd64.deb <span class="o">&amp;&amp;</span> <span class="nb">sudo </span><span class="nv">WAZUH_MANAGER_IP</span><span class="o">=</span><span class="s1">'172.25.10.50'</span>  dpkg <span class="nt">-i</span> ./wazuh-agent.deb
</code></pre></div></div>

<h5 id="step-02-extract-new-agents-key">STEP 02: Extract new agent‚Äôs key</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@wazuh-elk ~]# /var/ossec/bin/manage_agents <span class="nt">-e</span> 002
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Agent key information <span class="k">for</span> <span class="s1">'002'</span> is: 
<span class="nv">MDAyIERBLVBDIDE3Mi4yNS4xMC4xMTAgMDU3NGM5NGE3M2I5MDE4ZTE5NDdmMGQ4NTBjYzE0MWIwNDgwYTViZGY4YmY0NmU5MTA1ZWE2YWZmN2M3ODc2OA</span><span class="o">==</span>
</code></pre></div></div>

<p><strong>On the Agent</strong></p>

<h5 id="step-03-import-the-created-key-for-new-agent-at-the-manger">STEP 03: Import the created key for new agent at the Manger</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DA-PC:~# /var/ossec/bin/manage_agents <span class="nt">-i</span> <span class="nv">MDAyIERBLVBDIDE3Mi4yNS4xMC4xMTAgMDU3NGM5NGE3M2I5MDE4ZTE5NDdmMGQ4NTBjYzE0MWIwNDgwYTViZGY4YmY0NmU5MTA1ZWE2YWZmN2M3ODc2OA</span><span class="o">==</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Agent information:
   ID:002
   Name:DA-PC
   IP Address:172.25.10.110

Confirm adding it?<span class="o">(</span>y/n<span class="o">)</span>: y
Added.
</code></pre></div></div>

<h5 id="step-04-restart-wazuh-agent-service">STEP 04: Restart Wazuh Agent Service</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@DA-PC:~# systemctl restart wazuh-agent.service
</code></pre></div></div>
<p><img src="/images/pages/wazuh/1.png" width="100%" />
<img src="/images/pages/wazuh/2.png" width="100%" />
<img src="/images/pages/wazuh/3.png" width="100%" /></p>
:ET