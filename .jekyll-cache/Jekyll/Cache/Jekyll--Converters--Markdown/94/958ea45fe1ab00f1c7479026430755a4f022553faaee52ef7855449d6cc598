I"Ò'<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>
<div class="embed-container"><iframe src="https://www.youtube.com/embed/c1BWzUgGm6I?&amp;autoplay=1" frameborder="0" allowfullscreen=""></iframe></div>

<h2 id="setup-postfix-to-send-emails-using-gmail-relay">Setup Postfix To Send Emails Using Gmail Relay</h2>

<p>In this tutorial I‚Äôm going to tech you how to configure an email relay server for the with your Gmail account.
Which helps you to send email through the Linux terminal and email automation tasks such as Nagios, Zabbix, and many more other scripts.</p>

<p>Here I‚Äôm going to set up the email server with authentication using smtp.gmail.com as a relay host in the following way</p>

<p>STEP 01: Generate App Password For Postfix</p>

<h4 id="1-first-you-need-to-have-a-gmail-email-account">1. First you need to have a Gmail email account.</h4>

<p>Login to Google account from here:</p>

<p>Manage your account access and security settings.</p>

<p>Scroll down to ‚ÄúPassword &amp; sign-in method‚Äù and click 2-Step Verification. Then enable it.</p>

<p><a href="https://myaccount.google.com/security" target="_blank">https://myaccount.google.com/security</a></p>

<h4 id="2-click-the-following-link-to-generate-an-app-password-for-postfix">2. Click the following link to Generate an App password for Postfix.</h4>

<p><a href="https://security.google.com/settings/security/apppasswords" target="_blank">https://security.google.com/settings/security/apppasswords</a></p>

<h4 id="3-genarate-an-app-passwaord">3. Genarate an App Passwaord</h4>

<p>Click Select app and choose Other (provide any name) from the drop-down menu. Enter ‚ÄúPostfix‚Äù and click Generate . And save the password.</p>

<p>STEP 02: Install &amp; Configure Postfix Mail Server</p>

<h4 id="1-install-postfix-package">1. Install Postfix Package</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@nagios ~]# systemctl restart postfix
</code></pre></div></div>

<h4 id="2-install-sasl-binaries-and-libraries">2. Install SASL binaries and libraries</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@nagios ~]# <span class="nb">sudo </span>yum <span class="nb">install </span>cyrus-sasl cyrus-sasl-lib cyrus-sasl-plain
</code></pre></div></div>

<h4 id="3-create-sasl-password-to-able-to-authenticate-with-the-gmail-server">3. Create SASL Password to able to authenticate with the Gmail server</h4>

<p>Open or create the /etc/postfix/sasl/sasl_passwd file and add the SMTP Host, username, and password information:
Store Password Inside /etc/postfix/sasl_passwd</p>

<blockquote>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@nagios ~]# vim /etc/postfix/sasl/sasl_passwd
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>smtp.gmail.com]:587 username@gmail.com:exhhwavdchsihk3l
</code></pre></div></div>

<h4 id="6-create-a-hash-db-for-the-password">6. Create a HASH DB for the password</h4>

<p>Create the hash db file for Postfix by running the postmap command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postmap /etc/postfix/sasl/sasl_passwd
</code></pre></div></div>

<p>Compile password to db (we can safely remove previous clear-text file now)</p>

<h4 id="7-set-required-ownershippermissions-for-the-following-files">7. Set required ownership/permissions for the following files:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown </span>root:root /etc/postfix/sasl/sasl_passwd /etc/postfix/sasl/sasl_passwd.db
<span class="nb">sudo chmod </span>0600 /etc/postfix/sasl/sasl_passwd /etc/postfix/sasl sasl_passwd.db
</code></pre></div></div>

<h4 id="8-modify-relayhost-directive-in-etcpostfixmaincf-to-match-the-following-example">8. Modify relayhost directive in /etc/postfix/main.cf to match the following example:</h4>

<p>Define the following directives at the end of <strong>/etc/postfix/main.cf</strong> file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># This tells Postfix to hand off all messages to Gmail, and never do direct delivery.</span>
relayhost <span class="o">=</span> <span class="o">[</span>smtp.gmail.com]:587

<span class="c"># This tells Postfix to provide the username/password when Gmail asks for one.</span>
<span class="c"># Enable SASL authentication</span>
smtp_sasl_auth_enable <span class="o">=</span> <span class="nb">yes</span>
<span class="c"># Disallow methods that allow anonymous authentication</span>
smtp_sasl_security_options <span class="o">=</span> noanonymous
<span class="c"># Location of sasl_passwd</span>
smtp_sasl_password_maps <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/sasl/sasl_passwd
<span class="c"># Enable STARTTLS encryption</span>
smtp_tls_security_level <span class="o">=</span> encrypt
<span class="c"># Location of CA certificates</span>
smtp_tls_security_level <span class="o">=</span> verify
smtp_tls_CAfile <span class="o">=</span> /etc/ssl/certs/ca-bundle.crt
</code></pre></div></div>

<p>Either, You can add following entries using  ‚Äúpostconf -e‚Äù command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postconf <span class="nt">-e</span> <span class="nv">relayhost</span><span class="o">=[</span>smtp.gmail.com]:587
postconf <span class="nt">-e</span> <span class="nv">smtp_sasl_auth_enable</span><span class="o">=</span><span class="nb">yes
</span>postconf <span class="nt">-e</span> <span class="nv">smtp_sasl_security_options</span><span class="o">=</span>noanonymous
postconf <span class="nt">-e</span> <span class="nv">smtp_sasl_password_maps</span><span class="o">=</span><span class="nb">hash</span>:/etc/postfix/sasl/sasl_passwd
postconf <span class="nt">-e</span> <span class="nv">smtp_tls_security_level</span><span class="o">=</span>encrypt
postconf <span class="nt">-e</span> <span class="nv">smtp_tls_security_level</span><span class="o">=</span>verify
postconf <span class="nt">-e</span> <span class="nv">smtp_tls_CAfile</span><span class="o">=</span>/etc/ssl/certs/ca-bundle.crt
</code></pre></div></div>

<p>Finally ‚Äúmain.cf‚Äù file will be look alike this‚Ä¶</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alias_database <span class="o">=</span> <span class="nb">hash</span>:/etc/aliases
alias_maps <span class="o">=</span> <span class="nb">hash</span>:/etc/aliases
command_directory <span class="o">=</span> /usr/sbin
config_directory <span class="o">=</span> /etc/postfix
daemon_directory <span class="o">=</span> /usr/libexec/postfix
data_directory <span class="o">=</span> /var/lib/postfix
debug_peer_level <span class="o">=</span> 2
debugger_command <span class="o">=</span> <span class="nv">PATH</span><span class="o">=</span>/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin ddd <span class="nv">$daemon_directory</span>/<span class="nv">$process_name</span> <span class="nv">$process_id</span> &amp; <span class="nb">sleep </span>5
html_directory <span class="o">=</span> no
inet_interfaces <span class="o">=</span> all
inet_protocols <span class="o">=</span> ipv4
mail_owner <span class="o">=</span> postfix
mailq_path <span class="o">=</span> /usr/bin/mailq.postfix
manpage_directory <span class="o">=</span> /usr/share/man
mydestination <span class="o">=</span> <span class="nv">$myhostname</span>, localhost.<span class="nv">$mydomain</span>, localhost
newaliases_path <span class="o">=</span> /usr/bin/newaliases.postfix
queue_directory <span class="o">=</span> /var/spool/postfix
readme_directory <span class="o">=</span> /usr/share/doc/postfix-2.10.1/README_FILES
relayhost <span class="o">=</span> <span class="o">[</span>smtp.gmail.com]:587
sample_directory <span class="o">=</span> /usr/share/doc/postfix-2.10.1/samples
sendmail_path <span class="o">=</span> /usr/sbin/sendmail.postfix
setgid_group <span class="o">=</span> postdrop
smtp_always_send_ehlo <span class="o">=</span> <span class="nb">yes
</span>smtp_sasl_auth_enable <span class="o">=</span> <span class="nb">yes
</span>smtp_sasl_password_maps <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/sasl/sasl_passwd
smtp_sasl_security_options <span class="o">=</span> noanonymous
smtp_tls_CAfile <span class="o">=</span> /etc/ssl/certs/ca-bundle.crt
smtp_tls_security_level <span class="o">=</span> verify
unknown_local_recipient_reject_code <span class="o">=</span> 550
</code></pre></div></div>

<h4 id="8-set-sender-email-address-in-etcaliases-file">8 Set Sender Email Address in /etc/aliases File</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@nagios ~]# vim /etc/aliases
root:       Mail_ID@gmail.com
</code></pre></div></div>

<h4 id="9-enable--restart-postfix-service">9: Enable &amp; Restart Postfix Service</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@nagios ~]# systemctl <span class="nb">enable </span>postfix
<span class="o">[</span>root@nagios ~]# systemctl restart postfix
</code></pre></div></div>

<h4 id="10-sending-an-test-email">10: Sending an Test Email:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span>  <span class="s2">"Mail Body - Test Message from NAgiso Digital Avenue"</span> | mailx <span class="nt">-vvv</span> <span class="nt">-s</span> <span class="s2">"Subjct is Mail Sending from Digital Avenue"</span> username@gmail.com
</code></pre></div></div>

:ET